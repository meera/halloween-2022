import Head from "next/head";
import Image from "next/image";
import styles from "../styles/Home.module.css";
import useSWR from "swr";
import { useRef, useState } from "react";

export default function Home() {

  const [play, setPlay] = useState<boolean>(false)
  const fetcher = (url: string) => fetch(url).then((res) => res.json());

  const { data, error } = useSWR("/api/trigger", fetcher, {
    refreshInterval: 100,
  });
  const musicPlayers = useRef<HTMLAudioElement | undefined>(
    typeof Audio !== "undefined"
      ? new Audio("/let-the-mystery-unfold.mp3")
      : undefined
  );

  if (error) return "An error has occurred.";
  if (!data) return "Loading...";
  if (data) console.log("Data", data);
  if (data) console.log("Data Trigger", data.trigger);

  async function handleClick() {

   setPlay(true);
  };
  if( !play ){
    return <button onClick={handleClick}> Play</button>
  }
  if (data.trigger) {
    musicPlayers.current?.play();

    return (
      <div className={styles.container}>
        <Head>
          <title>Halloween 2022</title>
          <meta name="description" content="Generated by create next app" />
          <link rel="icon" href="/favicon.ico" />
        </Head>

        <main className={styles.main}>
          <Image src="/pumpkin.gif" alt="pumpkin" fill />
        </main>
      </div>
    );
  } else {
    musicPlayers.current?.play();

    return (
      <div className={styles.container}>
        <Head>
          <title>Halloween 2022</title>
          <meta name="description" content="Generated by create next app" />
          <link rel="icon" href="/favicon.ico" />
        </Head>

        <main className={styles.main}>
          <Image src="/cat-pumpkin.gif" alt="pumpkin" fill />
        </main>
      </div>
    );
  }
}
